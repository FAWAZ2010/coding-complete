"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9800],{69800:function(e,t,s){s.r(t),s.d(t,{default:function(){return A}});var n=s(30266),r=s(809),i=s.n(r),a=s(38198),o=s(23634),c=s(67294),l=s(19889),d=s(15915),m=s(59028),u=s(76938),f=s(36580),p=s(53731),h=s(10245),g=s(85893),x=function(e,t,s){return(0,g.jsx)("a",{className:"text-orange underline",href:e,target:"_blank",rel:"noopener noreferrer",children:t},s)},N=function(e){var t=e.messages,s=e.messagesLoaded,n=e.userId,r=e.localUserName,i=e.remoteUsers;return(0,g.jsx)(g.Fragment,{children:0===t.length?(0,g.jsx)("div",{className:"w-full flex flex-col items-center justify-center",children:s?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(h.Z,{className:"text-grey-300",size:100}),(0,g.jsx)("span",{className:"text-grey-800",children:(0,g.jsx)(a.cC,{id:"trialClass.classroom.chat.noMessages"})})]}):(0,g.jsx)(f.Z,{classes:"text-orange h-8 w-8"})}):(0,g.jsx)("div",{className:"w-full flex flex-col-reverse px-2 overflow-y-auto",children:t.map((function(e){var t,s;return(0,g.jsxs)("div",{className:"flex my-3",children:[e.from!==n&&(0,g.jsx)("div",{className:"flex items-start mr-1",children:(0,g.jsx)(u.Z,{image:null===(t=i.filter((function(t){return t.userId===parseInt(e.from)}))[0])||void 0===t?void 0:t.avatar,isNotCurrentUser:!0})}),(0,g.jsxs)("div",{className:"flex flex-1 relative flex-col my-1 ".concat(e.from===n?"items-end":"items-start"),children:[e.from===n?(0,g.jsx)("div",{className:"w-0 h-0 absolute border-grey-200 border-solid -ml-10",style:{borderLeftWidth:"16px",borderBottomWidth:"16px",borderBottomColor:"transparent"}}):(0,g.jsx)("div",{className:"w-0 h-0 absolute border-orange-200 border-solid -mr-10",style:{borderRightWidth:"16px",borderBottomWidth:"16px",borderBottomColor:"transparent"}}),(0,g.jsx)("div",{className:"px-3 py-2 text-grey text-sm w-5/6 rounded break-all ".concat(e.from===n?"bg-grey-200 mr-3":"bg-orange-200 ml-3"),children:(0,g.jsx)(p.Z,{componentDecorator:x,children:e.text.split("\n").map((function(e){return(0,g.jsx)("p",{children:e},e)}))})}),e.timestamp&&(0,g.jsxs)("div",{className:"w-5/6 ".concat(e.from!==n&&"ml-6"),children:[(0,g.jsx)("span",{className:"text-xs mx-1",children:e.from===n?r:null===(s=i.filter((function(t){return t.userId===parseInt(e.from)}))[0])||void 0===s?void 0:s.name}),(0,g.jsx)("span",{className:"text-grey-800",children:"."}),(0,g.jsx)("span",{className:"text-grey-800 text-xs mx-1",children:o.ag.date(m.ZP.unix(e.timestamp.seconds).toDate(),{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hourCycle:"h12"})})]})]}),e.from===n&&(0,g.jsx)("div",{className:"flex items-start ml-1",children:(0,g.jsx)(u.Z,{})})]},String(e.timestamp))}))})})},_=s(11414),E=s(8514),S=function(e){var t=e.handleSubmit,s=e.messageText,n=e.setMessageText,r=(0,c.useRef)(null),i=(0,c.useRef)(null);return(0,g.jsxs)("form",{onSubmit:t,className:"border-t border-grey-500 flex justify-between items-center py-5 px-3 space-x-5",ref:r,children:[(0,g.jsxs)("div",{className:"relative flex-1",children:[(0,g.jsx)(E.Z,{className:" py-1 border-b-2 border-orange-400 text-sm placeholder-grey-800 tracking-wider focus:outline-none w-full",placeholder:o.ag._({id:"trialClass.classroom.chat.placeholder",message:"Send a message"}),value:s,onChange:function(e){return n(e.target.value)},maxRows:3,onKeyPress:function(e){var t;if("Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),null===(t=r.current)||void 0===t||t.requestSubmit(),!i.current))return}}),(0,g.jsx)("p",{className:"absolute bottom-0 left-0 -mb-4 text-xs text-grey-800 hidden md:block",children:(0,g.jsx)(a.cC,{id:"trialClass.classroom.chat.newLineInfo"})})]}),(0,g.jsxs)("button",{className:"bg-orange px-1 py-1 text-white text-sm rounded flex items-center justify-center focus:outline-none hover:bg-orange-500",children:[(0,g.jsx)("span",{className:"px-1",children:(0,g.jsx)(a.cC,{id:"trialClass.classroom.chat.sendBtn"})}),(0,g.jsx)(_.Z,{className:"text-white",size:16})]})]})},T=s(81292),b=s(43532),I=s(78268),v=function(e){var t=e.batchId,s=e.userId,r=e.localUserName,m=e.remoteUsers,u=e.setShowNewMessageAlert,f=e.close,p=(0,c.useState)(null),h=p[0],x=p[1],_=(0,c.useState)(""),E=_[0],v=_[1],A=(0,c.useState)([]),j=A[0],w=A[1],y=(0,c.useState)(!1),C=y[0],R=y[1],O=(0,c.useState)(!1),L=O[0],G=O[1],M="lastReceivedMsg",P=function(){var e=(0,n.Z)(i().mark((function e(){var s,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=d.RZ.collection("batches").doc(t),e.next=3,s.get();case 3:if(!e.sent.exists){e.next=8;break}x(s),e.next=18;break;case 8:return e.prev=8,n=d.RZ.collection("batches").doc(t),e.next=12,n.set({});case 12:x(n),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(8),console.error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[8,15]])})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){P()}),[]),(0,c.useEffect)((function(){var e=new Audio((0,T.staticFile)("/sounds/message-notification.wav"));L&&((0,b.playSound)(e),G(!1))}),[L]),(0,c.useEffect)((function(){if(h){var e=h.collection("messages").orderBy("timestamp","desc").onSnapshot((function(e){var t=[];e.forEach((function(e){t.push(e.data())}));var n=JSON.parse(window.localStorage.getItem(M)),r=t.length>0&&t[0];if(!n){var i=t.find((function(e){return e.from!==s})),a=null,o={seconds:null,nanoseconds:null};i&&(a=i.from,o=i.from),window.localStorage.setItem(M,JSON.stringify({from:a,timestamp:o}))}t.length>0&&r.from!==s&&(n&&!(n.timestamp.seconds===r.timestamp.seconds)&&!(n.timestamp.nanoseconds===r.timestamp.nanoseconds)&&(u(!0),G(!0)),window.localStorage.setItem(M,JSON.stringify({from:r.from,timestamp:r.timestamp})));w(t),C||R(!0)}),(function(e){console.error(e)}));return function(){return e()}}}),[h]);var D=function(){var e=(0,n.Z)(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),0!==(n=E.trim()).length){e.next=4;break}return e.abrupt("return");case 4:return r={text:n,from:s,timestamp:d.ZP.firestore.FieldValue.serverTimestamp()},e.prev=5,v(""),e.next=9,h.collection("messages").add(r);case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(5),console.error(e.t0),l.Z.error(o.ag._({id:"trialClass.classroom.chat.errorMessage",message:"There was an error sending your message. Please try again!"}));case 15:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}();return(0,g.jsxs)("div",{className:"flex flex-col w-full",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-grey-500",children:[(0,g.jsx)("p",{className:"text-xl text-grey font-600",children:(0,g.jsx)(a.cC,{id:"trialClass.classroom.chat.heading"})}),(0,g.jsx)("button",{type:"button",className:"focus:outline-none",onClick:f,children:(0,g.jsx)(I.Z,{})})]}),(0,g.jsx)("div",{className:"flex flex-1 w-full overflow-y-hidden",children:(0,g.jsx)(N,{messages:j,messagesLoaded:C,userId:s,localUserName:r,remoteUsers:m})}),(0,g.jsx)(S,{messageText:E,handleSubmit:D,setMessageText:v})]})},A=c.memo(v)},76938:function(e,t,s){var n=s(23634),r=s(31960),i=s(6661),a=s(8056),o=s(94184),c=s.n(o),l=s(85893),d=a.y7.MALE,m=a.y7.FEMALE,u=i.V.MALE_AVATAR,f=i.V.FEMALE_AVATAR,p=i.V.UNSPECIFIED_AVATAR;t.Z=function(e){var t=e.image,s=e.name,i=e.size,a=e.userGender,o=e.isNotCurrentUser,h=void 0!==o&&o,g=e.imageClass,x=void 0===g?"border-white":g,N=e.className,_="big"===i?"h-24 w-24":"medium"===i?"h-12 w-12":"tiny"===i?"h-6 w-6":"h-8 w-8",E=(0,r.T)(),S=E.avatar,T=E.gender,b=a||!h&&T,I=b===d?u:b===m?f:p,v=t||(h?I:S||I);return(0,l.jsxs)("div",{className:c()("flex-shrink-0 flex flex-col items-center justify-center",N),children:[(0,l.jsx)("img",{src:v,alt:s||n.ag._("Profile Image"),className:"".concat(_," rounded-full border ").concat(x)}),s&&(0,l.jsx)("span",{className:"text-grey-800 capitalize mt-2 text-center",children:s})]})}},6661:function(e,t,s){s.d(t,{kS:function(){return n},Kr:function(){return r},kf:function(){return i},Hn:function(){return a},oG:function(){return o},op:function(){return c},V:function(){return l},x8:function(){return d},m:function(){return m},uf:function(){return u},zd:function(){return f},Fk:function(){return p},xZ:function(){return h},_S:function(){return g},TT:function(){return x},yv:function(){return N}});var n=5,r=[["Grade 1","Grade 2","Grade 3"],["Grade 4","Grade 5"],["Grade 6","Grade 7","Grade 8"],["Grade 9","Grade 10"],["Grade 11","Grade 12"],["Undergraduate"]],i={class:20,rescheduledClass:5,earlyClassReschedulePenalty:15,lateClassReschedulePenalty:50,didNotShowUpForTheClassPenalty:100,quizOnTimeSubmission:100,quizLateSubmission:50,projectOnTimeSubmission:100,projectLateSubmission:50},a=[{points:"+".concat(i.class," points"),description:"Attending classes"},{points:"+".concat(i.projectOnTimeSubmission," points"),description:"Project submission on time"},{points:"+".concat(i.projectLateSubmission," points"),description:"Project submission after due date"},{points:"+".concat(i.quizOnTimeSubmission," points"),description:"Quiz submission on time"},{points:"+".concat(i.quizLateSubmission," points"),description:"Quiz submission after due date"}],o={none:{lowest:Number.NEGATIVE_INFINITY,highest:-1},bronze:{lowest:0,highest:4999},silver:{lowest:5e3,highest:9999},gold:{lowest:1e4,highest:19999},diamond:{lowest:2e4,highest:Number.POSITIVE_INFINITY}},c={NONE:"None",BRONZE:"Bronze",SILVER:"Silver",GOLD:"Gold",DIAMOND:"Diamond"},l={MALE_AVATAR:"https://fastly.codingal.com/images/gamification/male_user.png",FEMALE_AVATAR:"https://fastly.codingal.com/images/gamification/female_user.png",UNSPECIFIED_AVATAR:"https://fastly.codingal.com/images/gamification/unspecified_user.png"},d="/images/gamification/fallback.jpg",m=50,u={none:{lowest:Number.NEGATIVE_INFINITY,highest:-1},bronze:{lowest:0,highest:24999},silver:{lowest:25e3,highest:74999},gold:{lowest:75e3,highest:149999},diamond:{lowest:15e4,highest:299999},platinum:{lowest:3e5,highest:499999},sapphire:{lowest:5e5,highest:799999},emerald:{lowest:8e5,highest:Number.POSITIVE_INFINITY}},f={NONE:"None",BRONZE:"Bronze",SILVER:"Silver",GOLD:"Gold",DIAMOND:"Diamond",PLATINUM:"Platinum",SAPPHIRE:"Sapphire",EMERALD:"Emerald"},p={none:0,bronze:1,silver:2,gold:3,diamond:4,platinum:5,sapphire:6,emerald:7},h={CLASS_JOIN_LATE:-100,DID_NOT_JOIN_CLASS:-200,CLASS_JOIN_ON_TIME_AND_COMPLETING_CLASS:50,CLASS_JOIN_ON_TIME_AND_NOT_COMPLETING_CLASS:20,STUDENT_ENROLLMENT:500,PROJECT_REVIEW_LATE:-100,PROJECT_REVIEW_ON_TIME:50,THREE_STAR_OR_BELOW_RATING:-200,FOUR_STAR_RATING:50,FIVE_STAR_RATING:100,INSTANT_CLASS_REQUEST_ACCEPTED:20},g=5,x=[{points:"+".concat(h.INSTANT_CLASS_REQUEST_ACCEPTED," points"),description:"Accepting an instant trial class request"},{points:"+".concat(h.CLASS_JOIN_ON_TIME_AND_COMPLETING_CLASS," points"),description:"Joining on time (before 1 min) and completing the class"},{points:"+".concat(h.CLASS_JOIN_ON_TIME_AND_NOT_COMPLETING_CLASS," points"),description:"Joining on time (before 1 min) and not completing the class"},{points:"".concat(h.CLASS_JOIN_LATE," points"),description:"Joining late (after 1 min)"},{points:"".concat(h.DID_NOT_JOIN_CLASS," points"),description:"Not joining a class"},{points:"+".concat(h.PROJECT_REVIEW_ON_TIME," points"),description:"Reviewing project on time"},{points:"".concat(h.PROJECT_REVIEW_LATE," points"),description:"Reviewing project late"},{points:"+".concat(h.STUDENT_ENROLLMENT," points"),description:"Converting a student"},{points:"".concat(h.THREE_STAR_OR_BELOW_RATING," points"),description:"Student has given <=3 star rating"},{points:"+".concat(h.FOUR_STAR_RATING," points"),description:"Student has given 4 star rating"},{points:"+".concat(h.FIVE_STAR_RATING," points"),description:"Student has given 5 star rating"}],N="/images/teacher-dashboard/"}}]);
//# sourceMappingURL=9800.ceda88f3c97da13a642f.js.map